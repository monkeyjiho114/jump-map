<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="screen-orientation" content="landscape">
  <title>붕어빵 점프맵</title>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="icon.svg">
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet" onerror="this.remove()">
</head>
<body>
  <script src="three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- Auth Screen -->
  <div id="auth-screen" class="screen active">
    <div class="screen-content auth-content">
      <h1 class="game-title auth-game-title">붕어빵 점프맵</h1>
      <p class="game-subtitle">Bungeoppang Jump Map</p>
      <div id="auth-form-container">
        <!-- Login -->
        <div id="auth-login" class="auth-form">
          <input type="email" id="auth-email" class="auth-input" placeholder="이메일" autocomplete="email">
          <input type="password" id="auth-password" class="auth-input" placeholder="비밀번호" autocomplete="current-password">
          <button id="auth-login-btn" class="btn btn-primary auth-btn">로그인</button>
          <button id="auth-google-btn" class="btn auth-btn btn-google">
            <svg viewBox="0 0 24 24" width="18" height="18" style="margin-right:6px;vertical-align:middle"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 01-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
            Google 로그인
          </button>
          <p class="auth-switch">계정이 없나요? <a href="#" id="auth-show-register">회원가입</a></p>
          <button id="auth-guest-btn" class="btn btn-secondary auth-btn auth-guest">게스트로 플레이</button>
        </div>
        <!-- Register -->
        <div id="auth-register" class="auth-form" style="display:none;">
          <input type="text" id="auth-reg-name" class="auth-input" placeholder="닉네임" autocomplete="name">
          <input type="email" id="auth-reg-email" class="auth-input" placeholder="이메일" autocomplete="email">
          <input type="password" id="auth-reg-password" class="auth-input" placeholder="비밀번호 (6자 이상)" autocomplete="new-password">
          <button id="auth-register-btn" class="btn btn-primary auth-btn">회원가입</button>
          <p class="auth-switch">이미 계정이 있나요? <a href="#" id="auth-show-login">로그인</a></p>
        </div>
        <div id="auth-message" class="auth-message"></div>
      </div>
    </div>
  </div>

  <!-- Title Screen -->
  <div id="title-screen" class="screen active">
    <div class="screen-content">
      <h1 class="game-title">붕어빵 점프맵</h1>
      <p class="game-subtitle">Bungeoppang Jump Map</p>

      <!-- Difficulty Selection -->
      <div class="difficulty-section">
        <div class="difficulty-row">
          <label class="difficulty-label">게임 난이도</label>
          <button class="diff-arrow diff-left" data-target="game" data-dir="-1">◀</button>
          <div class="difficulty-display">
            <span class="difficulty-stars" id="game-diff-stars">★★★★★</span>
            <span class="difficulty-number" id="game-diff-number">5</span>
          </div>
          <button class="diff-arrow diff-right" data-target="game" data-dir="1">▶</button>
          <span class="difficulty-desc" id="game-diff-desc">보통</span>
        </div>
        <div class="difficulty-row">
          <label class="difficulty-label">퀴즈 난이도</label>
          <button class="diff-arrow diff-left" data-target="quiz" data-dir="-1">◀</button>
          <div class="difficulty-display">
            <span class="difficulty-stars" id="quiz-diff-stars">★★★</span>
            <span class="difficulty-number" id="quiz-diff-number">3</span>
          </div>
          <button class="diff-arrow diff-right" data-target="quiz" data-dir="1">▶</button>
          <span class="difficulty-desc" id="quiz-diff-desc">기본 단어</span>
        </div>
      </div>

      <div id="user-info-bar" class="user-info-bar" style="display:none;">
        <span id="user-display-name"></span>
        <button id="logout-btn" class="btn-text">로그아웃</button>
      </div>
      <button id="start-btn" class="btn btn-primary">게임 시작</button>
      <button id="continue-btn" class="btn btn-primary" style="display:none;">이어하기</button>
      <button id="leaderboard-btn" class="btn btn-secondary">리더보드</button>
      <div class="controls-hint">
        <p>방향키 이동 | Space 점프 | 마우스 카메라</p>
      </div>
    </div>
  </div>

  <!-- Character Select -->
  <div id="character-select" class="screen">
    <div class="screen-content">
      <h2>캐릭터 선택</h2>
      <div class="character-cards">
        <div class="character-card" id="pig-card">
          <canvas id="pig-preview" width="240" height="220"></canvas>
          <h3>돼지붕어빵</h3>
          <p>귀여운 돼지 얼굴의 붕어빵</p>
          <button id="pig-btn" class="btn btn-select">선택</button>
        </div>
        <div class="character-card" id="monkey-card">
          <canvas id="monkey-preview" width="240" height="220"></canvas>
          <h3>몽키붕어빵</h3>
          <p>장난꾸러기 원숭이 얼굴의 붕어빵</p>
          <button id="monkey-btn" class="btn btn-select">선택</button>
        </div>
      </div>
    </div>
  </div>

  <!-- HUD -->
  <div id="hud" class="screen">
    <div class="hud-top-left">
      <div class="hud-item" id="stage-name">스테이지 1</div>
    </div>
    <div class="hud-top-center">
      <div class="hud-item hud-timer" id="timer">00:00.00</div>
    </div>
    <div class="hud-top-right">
      <div class="hud-item">체크포인트 <span id="checkpoint-count">0/0</span></div>
      <div class="hud-item">사망 <span id="death-count">0</span></div>
    </div>
    <div class="hud-bottom-center">
      <div id="hud-ingredients" class="hud-ingredient-bar"></div>
    </div>
  </div>

  <!-- Pause Menu -->
  <div id="pause-menu" class="screen">
    <div class="screen-content">
      <h2>일시정지</h2>
      <button id="resume-btn" class="btn btn-primary">계속하기</button>
      <button id="restart-btn" class="btn btn-secondary">다시 시작</button>
      <button id="menu-btn" class="btn btn-secondary">메인 메뉴</button>
    </div>
  </div>

  <!-- Game Over -->
  <div id="game-over" class="screen">
    <div class="screen-content">
      <h2>게임 오버</h2>
      <button id="retry-btn" class="btn btn-primary">다시 시도</button>
    </div>
  </div>

  <!-- Stage Clear -->
  <div id="stage-clear" class="screen">
    <div class="screen-content">
      <h2 class="clear-title">스테이지 클리어!</h2>
      <div class="clear-stats">
        <p>시간: <span id="clear-time">00:00.00</span></p>
        <p>사망: <span id="clear-deaths">0</span>회</p>
      </div>
      <div class="clear-ingredient-section">
        <div class="ingredient-new" id="clear-new-ingredient"></div>
        <div id="stage-clear-ingredients" class="ingredient-grid"></div>
      </div>
      <button id="next-stage-btn" class="btn btn-primary">다음 스테이지</button>
    </div>
  </div>

  <!-- All Clear -->
  <div id="all-clear" class="screen">
    <div class="screen-content">
      <h2 class="clear-title">축하합니다!</h2>
      <h3>모든 스테이지를 클리어했습니다!</h3>
      <div class="clear-stats">
        <p>총 시간: <span id="total-time">00:00.00</span></p>
        <p>총 사망: <span id="total-deaths">0</span>회</p>
      </div>
      <div class="clear-ingredient-section">
        <h3 class="ingredient-complete-title">두바이 쫀득 쿠키 완성!</h3>
        <div id="all-clear-ingredients" class="ingredient-grid"></div>
      </div>
      <button id="all-clear-menu-btn" class="btn btn-primary">메인 메뉴</button>
    </div>
  </div>

  <!-- Leaderboard Screen -->
  <div id="leaderboard-screen" class="screen">
    <div class="screen-content leaderboard-content">
      <h2 class="leaderboard-title">리더보드</h2>
      <div id="leaderboard-table-container">
        <table id="leaderboard-table">
          <thead>
            <tr>
              <th>#</th>
              <th>플레이어</th>
              <th>캐릭터</th>
              <th>난이도</th>
              <th>시간</th>
              <th>사망</th>
              <th>점수</th>
            </tr>
          </thead>
          <tbody id="leaderboard-body"></tbody>
        </table>
      </div>
      <div id="leaderboard-loading" class="leaderboard-loading">로딩 중...</div>
      <div id="leaderboard-empty" class="leaderboard-empty" style="display:none;">아직 기록이 없습니다. 첫 번째 도전자가 되어보세요!</div>
      <button id="leaderboard-close-btn" class="btn btn-secondary">돌아가기</button>
    </div>
  </div>

  <!-- Quiz Screen -->
  <div id="quiz-screen" class="screen">
    <div class="screen-content quiz-content">
      <div id="quiz-emoji" class="quiz-emoji"></div>
      <div id="quiz-question" class="quiz-question"></div>
      <div id="quiz-choices" class="quiz-choices"></div>
      <button id="quiz-mic-btn" class="quiz-mic-btn">🎤 말하기</button>
      <div id="quiz-hint" class="quiz-hint"></div>
      <div id="quiz-feedback" class="quiz-feedback"></div>
      <button id="quiz-skip-btn" class="quiz-skip-btn">건너뛰기 ▶</button>
    </div>
  </div>

  <!-- Pause Button (always visible during gameplay) -->
  <button id="pause-btn-touch" aria-label="메뉴">☰</button>

  <!-- Touch Controls (mobile) -->
  <div id="touch-controls">
    <div id="joystick-area">
      <div id="joystick-base">
        <div id="joystick-thumb"></div>
      </div>
    </div>
    <button id="jump-btn-touch">JUMP</button>
  </div>

  <!-- Toast Container -->
  <div id="toast-container" class="toast-container"></div>

  <!-- Game Container -->
  <div id="game-container"></div>

  <script src="sound.js"></script>
  <script src="supabase.js"></script>
  <script src="characters.js"></script>
  <script src="levels.js"></script>
  <script src="ingredients.js"></script>
  <script src="input.js"></script>
  <script src="quiz-tier7.js"></script>
  <script src="quiz-tier8.js"></script>
  <script src="quiz-tier9.js"></script>
  <script src="quiz-tier10.js"></script>
  <script src="quiz-data.js"></script>
  <script src="quiz-manager.js"></script>
  <script src="game.js"></script>
</body>
</html>
